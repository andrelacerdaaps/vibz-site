generator client {
  provider      = "prisma-client-js"
  // Mantendo a configuração para o servidor da Hostinger
  binaryTargets = ["native", "debian-openssl-1.1.x", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum MidiaStatus {
  APPROVED
  PENDING
  REJECTED
}

model User {
  id              String    @id @default(uuid())
  nomeEmpresa     String
  email           String    @unique
  senha           String
  role            String    @default("CLIENTE")
  
  statusConta     String    @default("PENDENTE")
  
  emailVerificado Boolean   @default(false)
  codigoVerifica  String?

  validadePlano   DateTime?
  testeGratisUsado Boolean  @default(false)
  
  instagramId         String?
  instagramUser       String?
  accessToken         String?   @db.Text
  logoUrl             String?
  
  accessTokenMeta     String?   @db.Text
  instagramBusinessId String?
  
  planoId           String?
  plano             Plano?    @relation(fields: [planoId], references: [id])
  
  midias            Midia[]
  
  // --- CORREÇÃO: Ligação com a nova tabela de Pagamentos ---
  pagamentos        Pagamento[]
  
  createdAt         DateTime  @default(now())
}

model Plano {
  id           String   @id @default(uuid())
  nome         String
  preco        Float
  tipoCobranca String
  liberaVideo  Boolean  @default(false)
  liberaLayout Boolean  @default(false)
  usuarios     User[]
  createdAt    DateTime @default(now())
}

model Cupom {
  id        String   @id @default(uuid())
  codigo    String   @unique
  desconto  Float
  tipo      String
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Midia {
  id        String      @id @default(uuid())
  url       String      @db.Text
  tipo      String
  duracao   Int         @default(10)

  autor     String?
  avatar    String?

  dataPost  DateTime    @default(now())
  expiresAt DateTime    // Campo essencial para sua estratégia de 15h

  status    MidiaStatus @default(APPROVED)

  userId    String
  user      User        @relation(fields: [userId], references: [id])

  createdAt DateTime    @default(now())
}

model PreUser {
  id          String   @id @default(uuid())
  email       String   @unique
  nomeEmpresa String
  senha       String
  codigo      String
  createdAt   DateTime @default(now())
}

// --- NOVO MODELO: Para registrar transações do Mercado Pago ---
model Pagamento {
  id               String   @id @default(uuid())
  idTransacaoMP    String   @unique // ID oficial do Mercado Pago
  valor            Float
  status           String   @default("pending") // pending, approved, rejected
  metodo           String   @default("pix")
  
  userId           String
  user             User     @relation(fields: [userId], references: [id])
  
  planoId          String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}